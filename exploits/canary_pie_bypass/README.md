Thanks to https://ironhackers.es/tutoriales/pwn-rop-bypass-nx-aslr-pie-y-canary/ for the approach to the information leak.
I had to modify several thing in the leak stages, and I can't jump to main to reset the binary, I had to use _start.
Furthermore I bypassed aslr by ret2plt + pylibcdb and not leaking a libc address with the format string.